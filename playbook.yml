---
# playbook.yml
# Purpose: Set up PXE server base packages

# --------------------------
# Global vars and host key checking
# --------------------------
- name: Configure Ansible for PXE server
  hosts: localhost
  gather_facts: no
  tasks:
    - name: Disable SSH host key checking
      set_fact:
        ansible_ssh_common_args: '-o StrictHostKeyChecking=no -o UserKnownHostsFile=/dev/null'

# --------------------------
# Play 1: Ensure base packages on PXE server
# --------------------------
- name: Install base packages on PXE server
  hosts: pxe_servers
  become: yes
  gather_facts: yes
  tasks:
    - name: Update apt cache
      apt:
        update_cache: yes
        cache_valid_time: 3600

    - name: Ensure base packages are installed
      apt:
        name:
          - ntpdate
          - debootstrap
          - sudo
          - vim
          - curl
          - wget
          - net-tools
          - iproute2
          - rsync
        state: present
      ignore_errors: yes

    - name: Sync time with NTP
      command: ntpdate -u pool.ntp.org
      ignore_errors: yes

# --------------------------
# Play 2: PXE server setup (optional role)
# --------------------------
- name: Configure PXE server role
  hosts: pxe_servers
  become: yes
  gather_facts: yes
  roles:
    - pxe-server

# --------------------------
# Play 3: PXE clients placeholder
# --------------------------
- name: PXE clients (bare, placeholder)
  hosts: pxe_clients
  gather_facts: no
  tasks:
    - name: Placeholder task
      debug:
        msg: "PXE client is bare. Will boot via PXE once server is ready."

